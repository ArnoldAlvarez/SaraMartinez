<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Baile de Memoria con Sprites</title>
<style>
body {
  margin: 0;
  padding: 0;
  background: linear-gradient(180deg, #ff8c00, #ff0066);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  font-family: sans-serif;
  color: #fff;
}

h1 { margin-bottom: 10px; }

.game {
  display: flex;
  gap: 50px;
  align-items: flex-end;
  margin-bottom: 20px;
}

.character img {
  width: 120px;
  height: auto;
}

.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
}

.button {
  width: 70px;
  height: 70px;
  border-radius: 15px;
  background-color: #444;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  user-select: none;
  transition: transform 0.1s, background-color 0.2s;
}

.button.active {
  transform: scale(1.2);
  background-color: #fff;
  color: #000;
}
</style>
</head>
<body>

<h1>Baile de Memoria</h1>

<div class="game">
  <div class="character">
    <img id="payasita-sprite" src="sprites/payasita_1.png">
  </div>
  <div class="character">
    <img id="camaraman-sprite" src="sprites/camaraman_1.png">
  </div>
</div>

<div class="controls">
  <div class="button" data-key="A">A</div>
  <div class="button" data-key="S">S</div>
  <div class="button" data-key="D">D</div>
  <div class="button" data-key="F">F</div>
</div>

<audio id="music" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>

<script>
const moves = ['A','S','D','F'];
let sequence = [];
let userInput = [];

const payasitaSprite = document.getElementById('payasita-sprite');
const camaramanSprite = document.getElementById('camaraman-sprite');
const buttons = document.querySelectorAll('.button');
const music = document.getElementById('music');

// sonidos por tecla
const sounds = {
  A: new Audio('https://freesound.org/data/previews/341/341695_6244410-lq.mp3'),
  S: new Audio('https://freesound.org/data/previews/341/341696_6244410-lq.mp3'),
  D: new Audio('https://freesound.org/data/previews/341/341697_6244410-lq.mp3'),
  F: new Audio('https://freesound.org/data/previews/341/341698_6244410-lq.mp3')
};

let musicStarted = false;

// iniciar música al primer toque
function startMusic(){
  if(!musicStarted){
    music.play().catch(()=>{});
    musicStarted = true;
  }
}

// sprites frames
const payasitaFrames = [
  "sprites/payasita_1.png",
  "sprites/payasita_2.png",
  "sprites/payasita_3.png",
  "sprites/payasita_4.png"
];

const camaramanFrames = [
  "sprites/camaraman_1.png",
  "sprites/camaraman_2.png",
  "sprites/camaraman_3.png",
  "sprites/camaraman_4.png"
];

// animar sprite
function animateSprite(sprite, frames, times=1, interval=200){
  let i=0, count=0;
  const anim = setInterval(()=>{
    sprite.src = frames[i];
    i++;
    if(i >= frames.length){ 
      i=0; 
      count++;
      if(count >= times) clearInterval(anim);
    }
  }, interval);
}

// generar siguiente paso
function addStep() {
  const key = moves[Math.floor(Math.random()*moves.length)];
  sequence.push(key);
}

// mostrar secuencia (payasita baila)
function playSequence() {
  let i=0;
  const speed = 1000;

  const interval = setInterval(()=>{
    const key = sequence[i];
    const btn = document.querySelector(`.button[data-key="${key}"]`);
    btn.classList.add('active');
    animateSprite(payasitaSprite, payasitaFrames, 1, 200);
    sounds[key].currentTime = 0;
    sounds[key].play();

    setTimeout(()=>{ btn.classList.remove('active'); }, 400);

    i++;
    if(i>=sequence.length) clearInterval(interval);
  }, speed);
}

// manejar input del jugador
function handleInput(key){
  startMusic();
  sounds[key].currentTime = 0;
  sounds[key].play();

  const btn = document.querySelector(`.button[data-key="${key}"]`);
  btn.classList.add('active');
  animateSprite(camaramanSprite, camaramanFrames, 1, 200);

  setTimeout(()=>{ btn.classList.remove('active'); }, 400);

  userInput.push(key);

  if(userInput[userInput.length-1] !== sequence[userInput.length-1]){
    animateSprite(payasitaSprite, [payasitaFrames[3]], 1, 200); // error
    userInput = [];
    sequence = [];
    addStep();
    setTimeout(()=>playSequence(), 800);
  } else if(userInput.length === sequence.length){
    animateSprite(payasitaSprite, payasitaFrames, 1, 200);
    animateSprite(camaramanSprite, camaramanFrames, 1, 200);
    setTimeout(()=>{
      userInput = [];
      addStep();
      playSequence();
    }, 600);
  }
}

// eventos táctiles y click
buttons.forEach(btn => {
  btn.addEventListener('touchstart',()=>{ handleInput(btn.dataset.key); });
  btn.addEventListener('click',()=>{ handleInput(btn.dataset.key); });
});

// iniciar juego
addStep();
playSequence();

</script>
</body>
</html>